import { DaySlice } from "app/screens/programacao/types";
import { useMemo, forwardRef } from "react";
import moment from "moment";
import { dateFormat } from "app/screens/programacao/constants";
import {
	Stories,
	Header,
	Body,
	Footer,
	Content,
	Tape,
	LogoSvg,
} from "./styles";
import Picture from "app/components/Picture";
import Session from "../Session";

type Builder = { data: any };

const Builder = forwardRef<HTMLDivElement, Builder>(({ data }, ref) => {
	const dates: DaySlice[] = useMemo(
		() =>
			data?.body
				?.map((date: DaySlice) => ({
					...date,
					day: moment(date.primary.session_day, dateFormat),
				}))
				.sort((a: DaySlice, b: DaySlice) => {
					if (a.primary.session_day === "invalid date") return 1;
					a.day.diff(b.day);
				}),
		[data]
	);

	return (
		<Stories ref={ref}>
			<Tape>
				<Picture
					src="https://images.prismic.io/matula/66f7e057-3ef9-4227-ba79-e62a9066ea15_tape.png?auto=compress,format"
					width={167}
					height={512}
					layout="responsive"
				/>
			</Tape>
			<Content>
				<Header>Minha Matula</Header>
				<Body>
					{dates?.map((date) => (
						<Session
							title={date.primary.session_title}
							key={date.primary.session_day}
							day={date.day}
							items={date.items}
						/>
					))}
				</Body>
				<Footer>
					<LogoSvg
						xmlns="http://www.w3.org/2000/svg"
						width={192}
						height={76}
						viewBox="0 0 192 47.37"
					>
						<path d="M47.906 30.57q-4.745 0-6.429-.1a11.644 11.644 0 01-4.387-.759q-1.634-.911-1.633-3.8V8.048Q32.14 15.64 25.202 30.571h-1.734L13.519 9.313a97.005 97.005 0 01-1.122 15.488q-1.94 10.375-7.245 12.147a5.687 5.687 0 01-1.837.354 3.671 3.671 0 01-2.194-.658 2.178 2.178 0 01-1.123-1.923A2.227 2.227 0 01.789 33a2.635 2.635 0 011.811-.709 3.22 3.22 0 012.041 1.012q1.122 1.012 1.582 1.012 2.856 0 2.857-16.55 0-6.124-.357-15.134-.663-1.315-4.132-1.468V-.005q6.939 0 8.827.253 3.367.354 4.49 2.38l8.266 14.984 5.917-12.5a7.639 7.639 0 013.622-3.988A15.619 15.619 0 0141.171.102q2.143-.1 6.734-.1v1.316q-2.807 0-3.52.659t-.714 3.4v20.534a3.7 3.7 0 00.612 2.561q.613.584 3.622.887z" />
						<path d="M76.969 30.52a23.769 23.769 0 01-6.594-.607 7.029 7.029 0 01-4.345-4.555l-1.125-3.138h-8.639l-.623 2.227q-1.071 3.585-2.245 4.68-1.429 1.395-4.9 1.394h-1.683V29.21q3.061-.957 4.643-6.15l5.612-18.4a24.16 24.16 0 011.275-3.188Q59.365.106 63.753.105l10.613 26.066a10.917 10.917 0 00.918 1.906c.475.652 1.036 1.249 1.683 1.283zm-12.646-9.97l-4.475-10.309L56.77 20.55zM100.999 7.946l-1.479.3q-2.143-4.13-3.826-5.457a8.838 8.838 0 00-4.439-1.275v24.338q0 2.688-1.479 3.65a9.086 9.086 0 01-4.031.911q-1.786.1-5.663.1v-1.217a3.294 3.294 0 002.464-.861 4.274 4.274 0 00.6-2.586V1.518a8.914 8.914 0 00-4.462 1.275q-1.693 1.326-3.847 5.457l-1.487-.3 2.3-7.845h23.06zM132.629 10.525c0 4.994-1.208 13.8-3.622 16.907q-3.164 3.948-9.081 3.948a13.467 13.467 0 01-6.479-1.62 11.463 11.463 0 01-4.668-4.581q-1.658-2.961-1.658-11.717V7.439q0-4.859-.8-5.415a4.033 4.033 0 00-1.75-.506V.101h.255q3.468 0 5.1.152a8.525 8.525 0 013.929.962q1.479.962 1.479 3.543v14.88a13.378 13.378 0 001.633 6.529q1.989 3.544 5.255 3.543 3.061 0 5.893-3.543c1.888-2.361 2.832-10.732 2.832-15.591a3.914 3.914 0 00-1.684-3.442q-1.582-.759-3.112-1.518a2.93 2.93 0 01-1.684-2.632 2.166 2.166 0 01.969-1.822 3.548 3.548 0 012.143-.709q2.7 0 4.081 3.9a18.977 18.977 0 01.969 6.172zM161.505 34.923q0 2.885-4.694 2.885-3.725 0-10.152-3.638t-10.2-3.639v-1.365a3.506 3.506 0 001.837-.506q.714-.555.714-3.285V5.258a7.053 7.053 0 00-.306-2.628 2.587 2.587 0 00-2.245-1.112V.101q3.367 0 5.1.152a7.276 7.276 0 014.388 1.544q1.274 1.241 1.275 4.277v18.98a11.369 11.369 0 001.352 5.289 12.532 12.532 0 003.546 4.277 2.9 2.9 0 001.786.81 4.169 4.169 0 002.551-1.544 4.173 4.173 0 012.6-1.544q2.448 0 2.448 2.581z" />
						<path d="M153.838 29.356a2.21 2.21 0 001.683-1.03 10.854 10.854 0 00.919-1.906L167.052.354q4.337 0 5.357 1.265a18.971 18.971 0 01.867 1.822q3.571 11.49 5.153 17.31 4.439 14.627 7.7 14.627.662 0 1.454-1.468a2.4 2.4 0 012.168-1.468 2.262 2.262 0 011.582.607 1.976 1.976 0 01.663 1.519 2.313 2.313 0 01-1.326 2.075 5.283 5.283 0 01-2.552.608q-5.308 0-10.156-9.819-1.581-3.188-2.3-4.96h-9.641l-1.276 3.135a7.5 7.5 0 01-4.38 4.555 23.715 23.715 0 01-6.526.607zm21.173-8.554q-3.78-9.319-4.087-10.226l-4.219 10.226zM37.367 47.279V40.93h5.029v.943h-4.042v1.832h3.63v.943h-3.63v2.63zm13.568 0h-4.078v-.961h1.545v-4.429h-1.545v-.959h4.077v.959H49.39v4.426h1.544zm9.874-.943v.943h-5.01V40.93h.987v5.406zm5.449-5.406l2.615 3.374 2.624-3.374h.951v6.349h-.987v-2.676q0-.59.023-1.116t.087-1.052l-2.4 3.02h-.6l-2.386-3.02q.064.526.082 1.052t.018 1.116v2.676h-.987V40.93zm16.933 6.349V40.93h5.029v.943h-4.041v1.832h3.63v.943h-3.63v2.63zm9.481 0V40.93h5.056v.943h-4.069v1.678h3.566v.943h-3.566v1.841h4.069v.943zm9.856-1.95a4.027 4.027 0 001.07.857 2.847 2.847 0 001.362.3 3.311 3.311 0 00.85-.109 1.682 1.682 0 00.672-.331.712.712 0 00.261-.567.555.555 0 00-.233-.472 1.776 1.776 0 00-.681-.268q-.448-.1-1.079-.177a6.054 6.054 0 01-1.349-.331 2.1 2.1 0 01-.882-.6 1.425 1.425 0 01-.311-.939 1.458 1.458 0 01.366-1 2.342 2.342 0 01.983-.635 4.01 4.01 0 011.367-.222 4.1 4.1 0 011.614.29 2.462 2.462 0 011.065.825l-.658.707a2.618 2.618 0 00-.85-.68 2.94 2.94 0 00-2.359-.032.718.718 0 00-.466.658.651.651 0 00.229.522 1.613 1.613 0 00.64.3 8.941 8.941 0 00.96.19 10.122 10.122 0 011.015.172 4.067 4.067 0 01.864.29 1.578 1.578 0 01.6.485 1.257 1.257 0 01.224.766 1.713 1.713 0 01-.352 1.075 2.238 2.238 0 01-1 .707 4.211 4.211 0 01-1.522.249 4.729 4.729 0 01-1.7-.29 3.446 3.446 0 01-1.344-.943zm11.246 1.95v-5.406h-2.3v-.943h5.65v.943h-2.359v5.406zm11.566 0h-4.078v-.961h1.545v-4.429h-1.545v-.959h4.078v.959h-1.546v4.426h1.545zm10.907-6.349l-2.813 6.349h-1.143l-2.88-6.349h1.123l1.673 3.8q.146.345.343.762t.343.8q.155-.381.334-.789t.315-.762l1.545-3.809zm8.6 6.349l-.713-1.506h-3.557l-.713 1.506h-1.03l2.99-6.349h1.125l2.985 6.349zm-2.99-4.227l-.841 1.778h2.67l-.85-1.814q-.128-.272-.247-.535t-.238-.571q-.119.317-.242.594t-.248.548zm13.138 3.283v.943h-5.01V40.93h.987v5.406z" />
					</LogoSvg>
				</Footer>
			</Content>
		</Stories>
	);
});

export default Builder;
